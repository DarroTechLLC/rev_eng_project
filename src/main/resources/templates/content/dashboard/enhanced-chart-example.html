<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main-layout}">
<head>
    <title>Enhanced Chart Export Example</title>
    
    <!-- Enhanced Highcharts with all export functionality -->
    <div th:replace="fragments/highcharts-scripts :: highcharts-with-utils"></div>
    <div th:replace="fragments/highcharts-scripts :: chart-export-menu"></div>
    
    <style>
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .chart-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .chart-type-selector {
            display: flex;
            gap: 5px;
        }
        .chart-type-button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background-color: #f8f9fc;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
        }
        .chart-type-button.active {
            background-color: #4e73df;
            color: white;
            border-color: #4e73df;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container-fluid">
        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">Enhanced Chart Export Example</h1>
            <p class="text-muted">This demonstrates the enhanced chart export functionality matching the Next.js implementation</p>
        </div>

        <!-- Chart Panel -->
        <div class="chart-panel">
            <div class="chart-nav">
                <div>
                    <h5>Production Volume Chart</h5>
                    <div class="chart-type-selector" id="chartTypeSelector">
                        <button class="chart-type-button active" data-type="line">Line</button>
                        <button class="chart-type-button" data-type="column">Column</button>
                        <button class="chart-type-button" data-type="bar">Bar</button>
                    </div>
                </div>
            </div>
            <div class="chart-container" id="productionChart"></div>
        </div>

        <!-- Instructions -->
        <div class="card">
            <div class="card-header">
                <h6 class="m-0 font-weight-bold text-primary">How to Use Enhanced Export</h6>
            </div>
            <div class="card-body">
                <p><strong>Features implemented:</strong></p>
                <ul>
                    <li>âœ… Custom export menu with dropdown (matching Next.js)</li>
                    <li>âœ… Enhanced XLSX export with proper formatting</li>
                    <li>âœ… Chart title-based filename generation</li>
                    <li>âœ… Multiple export formats: PNG, JPEG, SVG, PDF, CSV, XLS</li>
                    <li>âœ… Automatic file naming from chart title</li>
                    <li>âœ… Download icon in top-right corner of chart</li>
                </ul>
                <p><strong>Usage:</strong></p>
                <ol>
                    <li>Look for the download icon (ðŸ“¥) in the top-right corner of the chart</li>
                    <li>Click the icon to open the export menu</li>
                    <li>Select your preferred export format</li>
                    <li>Files will be automatically named based on the chart title</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Initializing Enhanced Chart Export Example');
            
            // Sample data
            const sampleData = [
                ['Farm A', 1200],
                ['Farm B', 1800],
                ['Farm C', 900],
                ['Farm D', 1500],
                ['Farm E', 2100]
            ];

            // Chart configuration
            let chartOptions = {
                chart: {
                    type: 'line',
                    height: 350
                },
                title: {
                    text: 'Production Volume by Farm'
                },
                xAxis: {
                    type: 'category'
                },
                yAxis: {
                    title: {
                        text: 'Volume (MMBTUs)'
                    }
                },
                series: [{
                    name: 'Production Volume',
                    data: sampleData
                }],
                exporting: {
                    enabled: true
                }
            };

            // Create chart
            const chart = Highcharts.chart('productionChart', chartOptions);
            
            // Initialize custom export menu
            const exportMenu = initChartExportMenu(chart, document.getElementById('productionChart'));
            
            console.log('âœ… Enhanced chart with export menu created');

            // Chart type selector functionality
            const typeButtons = document.querySelectorAll('#chartTypeSelector .chart-type-button');
            typeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Update active button
                    typeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update chart type
                    const newType = this.dataset.type;
                    chart.update({
                        chart: {
                            type: newType
                        }
                    });
                    
                    console.log('ðŸ“Š Chart type changed to:', newType);
                });
            });
        });
    </script>
</th:block>
</body>
</html> 