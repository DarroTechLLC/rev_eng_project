<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!-- Sidebar Fragment -->
<ul th:fragment="sidebar" class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
    <!-- Sidebar - Brand -->
    <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
        <div class="sidebar-brand-icon">
            <i class="fas fa-globe"></i>
        </div>
        <div class="sidebar-brand-text mx-3">Roeslein</div>
    </a>

    <!-- Divider -->
    <hr class="sidebar-divider my-0">

    <!-- Dashboard Section with SEO-friendly URLs -->
    <li class="nav-item">
        <a class="nav-link" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/daily-volume' : '/dashboard'}">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <!-- Dashboard Sub-items -->
        <div class="collapse show" id="dashboardSubmenu">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/daily-volume' : '/dashboard'}">
                    <i class="fas fa-fw fa-chart-bar"></i> Daily Volume
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/mtd-volume' : '/dashboard'}">
                    <i class="fas fa-fw fa-calendar-week"></i> MTD Volume
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/ytd-volume' : '/dashboard'}">
                    <i class="fas fa-fw fa-calendar"></i> YTD Volume
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/production-headcount' : '/dashboard'}">
                    <i class="fas fa-fw fa-users"></i> Production Headcount
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/dashboard/animal-headcount' : '/dashboard'}">
                    <i class="fas fa-fw fa-paw"></i> Animal Headcount
                </a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- Projects Section with SEO-friendly URL -->
    <li class="nav-item">
        <a class="nav-link" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/projects' : '/dashboard'}">
            <i class="fas fa-fw fa-project-diagram"></i>
            <span>Projects</span>
        </a>

        <!-- Projects Sub-items (with Farm Selector) -->
        <div class="collapse show" id="projectsSubmenu">
            <div class="bg-white py-2 collapse-inner rounded">
                <!-- Farm Selector Placeholder -->
                <div class="px-3 mb-2">
                    <span class="text-xs font-weight-bold text-primary mb-1">Select Farm</span>
                    <select id="farmSelector" class="form-control form-control-sm">
                        <option th:each="farm : ${farms}" th:value="${farm.id}"
                                th:text="${farm.name}"
                                th:selected="${farm.id == selectedFarmKey}"></option>
                    </select>
                </div>

                <!-- Project Links with SEO-friendly URLs -->
                <a class="collapse-item" th:href="${(selectedCompany != null && selectedFarm != null) ? 
                          '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + 
                          '/projects/' + selectedFarm.name.toLowerCase().replace(' ', '-') + '/production' : 
                          (selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/projects' : '/dashboard')}">
                    <i class="fas fa-fw fa-industry"></i> Production
                </a>
                <a class="collapse-item" th:href="${(selectedCompany != null && selectedFarm != null) ? 
                          '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + 
                          '/projects/' + selectedFarm.name.toLowerCase().replace(' ', '-') + '/livestock' : 
                          (selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/projects' : '/dashboard')}">
                    <i class="fas fa-fw fa-cow"></i> Livestock
                </a>
                <a class="collapse-item" th:href="${(selectedCompany != null && selectedFarm != null) ? 
                          '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + 
                          '/projects/' + selectedFarm.name.toLowerCase().replace(' ', '-') + '/digesters' : 
                          (selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/projects' : '/dashboard')}">
                    <i class="fas fa-fw fa-flask"></i> Digesters
                </a>
                <a class="collapse-item" th:href="${(selectedCompany != null && selectedFarm != null) ? 
                          '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + 
                          '/projects/' + selectedFarm.name.toLowerCase().replace(' ', '-') + '/metrics' : 
                          (selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/projects' : '/dashboard')}">
                    <i class="fas fa-fw fa-chart-pie"></i> Metrics
                </a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- AI Insights Section -->
    <li class="nav-item">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#aiSubmenu" aria-expanded="false">
            <i class="fas fa-fw fa-brain"></i>
            <span>AI Insights</span>
        </a>
        <div id="aiSubmenu" class="collapse" aria-labelledby="headingAI" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/ai/anomaly-detection' : '/dashboard'}">
                    <i class="fas fa-fw fa-exclamation-triangle"></i> Anomaly Detection
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/ai/trend-analysis' : '/dashboard'}">
                    <i class="fas fa-fw fa-chart-line"></i> Trend Analysis
                </a>
                <a class="collapse-item" th:href="${selectedCompany != null ? '/' + selectedCompany.name.toLowerCase().replace(' ', '-') + '/ai/production-forecasting' : '/dashboard'}">
                    <i class="fas fa-fw fa-calendar-alt"></i> Production Forecasting
                </a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">
</ul>

<!-- JavaScript for Farm Selector -->
<script th:fragment="sidebar-scripts">
    // Load jQuery first
    const jqueryScript = document.createElement('script');
    jqueryScript.src = 'https://code.jquery.com/jquery-3.6.0.min.js';
    jqueryScript.onload = function() {
        // After jQuery loads, load our farm selector script
        const farmSelectorScript = document.createElement('script');
        farmSelectorScript.src = '/js/farm-selector.js';
        document.head.appendChild(farmSelectorScript);
    };
    document.head.appendChild(jqueryScript);
</script>
</body>
</html>
