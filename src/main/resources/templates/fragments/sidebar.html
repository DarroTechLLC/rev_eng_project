<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!-- Sidebar Fragment -->
<ul th:fragment="sidebar" class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
    <!-- Sidebar - Brand -->
    <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
        <div class="sidebar-brand-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="sidebar-brand-text mx-3">Dashboard</div>
    </a>

    <!-- Divider -->
    <hr class="sidebar-divider my-0">

    <!-- Dashboard Section -->
    <li class="nav-item">
        <a class="nav-link" th:href="@{/dashboard/{companyKey}/daily-volume(companyKey=${selectedCompany?.id})}">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <!-- Dashboard Sub-items -->
        <div class="collapse show" id="dashboardSubmenu">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/daily-volume(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-chart-bar"></i> Daily Volume
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/mtd-volume(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-calendar-week"></i> MTD Volume
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/ytd-volume(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-calendar"></i> YTD Volume
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/production-headcount(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-users"></i> Production Headcount
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/animal-headcount(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-paw"></i> Animal Headcount
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/weekly-report(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-file-alt"></i> Weekly Report
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/daily-report(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-file"></i> Daily Report
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/production-detail(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-info-circle"></i> Production Detail
                </a>
                <a class="collapse-item" th:href="@{/dashboard/{companyKey}/market-data(companyKey=${selectedCompany?.id})}">
                    <i class="fas fa-fw fa-chart-line"></i> Market Data
                </a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">

    <!-- Projects Section -->
    <li class="nav-item">
        <a class="nav-link" th:href="@{/projects/{companyKey}(companyKey=${selectedCompany?.id})}">
            <i class="fas fa-fw fa-project-diagram"></i>
            <span>Projects</span>
        </a>

        <!-- Projects Sub-items (with Farm Selector) -->
        <div class="collapse show" id="projectsSubmenu">
            <div class="bg-white py-2 collapse-inner rounded">
                <!-- Farm Selector Placeholder -->
                <div class="px-3 mb-2">
                    <span class="text-xs font-weight-bold text-primary mb-1">Select Farm</span>
                    <select id="farmSelector" class="form-control form-control-sm"
                            onchange="updateProjectLinks(this.value)">
                        <option th:each="farm : ${farms}" th:value="${farm.id}"
                                th:text="${farm.name}"
                                th:selected="${farm.id == selectedFarmKey}"></option>
                    </select>
                </div>

                <!-- Project Links -->
                <a class="collapse-item" th:href="@{/projects/{companyKey}/{farmKey}/production(companyKey=${selectedCompany?.id},farmKey=${selectedFarmKey})}">
                    <i class="fas fa-fw fa-industry"></i> Production
                </a>
                <a class="collapse-item" th:href="@{/projects/{companyKey}/{farmKey}/livestock(companyKey=${selectedCompany?.id},farmKey=${selectedFarmKey})}">
                    <i class="fas fa-fw fa-cow"></i> Livestock
                </a>
                <a class="collapse-item" th:href="@{/projects/{companyKey}/{farmKey}/digesters(companyKey=${selectedCompany?.id},farmKey=${selectedFarmKey})}">
                    <i class="fas fa-fw fa-flask"></i> Digesters
                </a>
                <a class="collapse-item" th:href="@{/projects/{companyKey}/{farmKey}/metrics(companyKey=${selectedCompany?.id},farmKey=${selectedFarmKey})}">
                    <i class="fas fa-fw fa-chart-pie"></i> Metrics
                </a>
            </div>
        </div>
    </li>

    <!-- Divider -->
    <hr class="sidebar-divider">
</ul>

<!-- JavaScript for Farm Selector -->
<script th:fragment="sidebar-scripts">
    function updateProjectLinks(farmKey) {
        // Store selected farm key in localStorage
        localStorage.setItem('selectedFarmKey', farmKey);

        // Redirect to the same page but with updated farm key
        const currentUrl = window.location.href;
        // Get the company ID from the URL
        const urlParts = window.location.pathname.split('/');
        const projectsIndex = urlParts.indexOf('projects');
        const companyKey = projectsIndex > 0 && projectsIndex < urlParts.length - 1 ? 
            urlParts[projectsIndex + 1] : '';

        if (currentUrl.includes('/projects/')) {
            // Only refresh if we're on a projects page
            const baseUrl = `/projects/${companyKey}/${farmKey}/`;
            const currentPage = urlParts[urlParts.length - 1] || 'production';
            window.location.href = baseUrl + currentPage;
        }
    }

    // Initialize when document is ready
    document.addEventListener('DOMContentLoaded', function() {
        // Set default farm key if none is selected
        if (!localStorage.getItem('selectedFarmKey') && document.getElementById('farmSelector')) {
            localStorage.setItem('selectedFarmKey', document.getElementById('farmSelector').value);
        }
        
        console.log("ðŸ§  Sidebar scripts loaded - updateProjectLinks function now available");
    });
</script>
</body>
</html>