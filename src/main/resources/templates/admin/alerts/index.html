<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<th:block th:replace="~{fragments/head :: head}"></th:block>-->

<!--<body id="page-top">-->
<!--    &lt;!&ndash; Page Wrapper &ndash;&gt;-->
<!--    <div id="wrapper">-->
<!--        &lt;!&ndash; Sidebar &ndash;&gt;-->
<!--        <th:block th:replace="~{fragments/sidebar :: sidebar}"></th:block>-->
<!--        &lt;!&ndash; End of Sidebar &ndash;&gt;-->

<!--        &lt;!&ndash; Content Wrapper &ndash;&gt;-->
<!--        <div id="content-wrapper" class="d-flex flex-column">-->
<!--            &lt;!&ndash; Main Content &ndash;&gt;-->
<!--            <div id="content">-->
<!--                &lt;!&ndash; Topbar &ndash;&gt;-->
<!--                <th:block th:replace="~{fragments/topbar :: topbar}"></th:block>-->
<!--                &lt;!&ndash; End of Topbar &ndash;&gt;-->

<!--                &lt;!&ndash; Begin Page Content &ndash;&gt;-->
<!--                <div class="container-fluid">-->
<!--                    &lt;!&ndash; Page Heading &ndash;&gt;-->
<!--                    <div class="d-sm-flex align-items-center justify-content-between mb-4">-->
<!--                        <h1 class="h3 mb-0 text-gray-800">Website Alerts-here</h1>-->
<!--                        <button type="button"  data-toggle="modal" data-target="#createAlertModal">-->
<!--                            <i class="fas fa-plus fa-sm text-white-50"></i> Create New Alert-->
<!--                        </button>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; Content Row &ndash;&gt;-->
<!--                    <div class="row">-->
<!--                        <div class="col-12">-->
<!--                            <div class="card shadow mb-4">-->
<!--                                <div class="card-header py-3">-->
<!--                                    <h6 class="m-0 font-weight-bold text-primary">Active Alerts</h6>-->
<!--                                </div>-->
<!--                                <div class="card-body">-->
<!--                                    <div class="table-responsive">-->
<!--                                        <table class="table table-bordered" id="alertsTable" width="100%" cellspacing="0">-->
<!--                                            <thead>-->
<!--                                                <tr>-->
<!--                                                    <th>ID</th>-->
<!--                                                    <th>Message</th>-->
<!--                                                    <th>Companies</th>-->
<!--                                                    <th>Created</th>-->
<!--                                                    <th>Updated</th>-->
<!--                                                    <th>Status</th>-->
<!--                                                    <th>Actions</th>-->
<!--                                                </tr>-->
<!--                                            </thead>-->
<!--                                            <tbody>-->
<!--                                                &lt;!&ndash; Alerts will be populated here &ndash;&gt;-->
<!--                                            </tbody>-->
<!--                                        </table>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                &lt;!&ndash; /.container-fluid &ndash;&gt;-->
<!--            </div>-->
<!--            &lt;!&ndash; End of Main Content &ndash;&gt;-->

<!--            &lt;!&ndash; Footer &ndash;&gt;-->
<!--            <th:block th:replace="~{fragments/footer :: footer}"></th:block>-->
<!--            &lt;!&ndash; End of Footer &ndash;&gt;-->
<!--        </div>-->
<!--        &lt;!&ndash; End of Content Wrapper &ndash;&gt;-->
<!--    </div>-->
<!--    &lt;!&ndash; End of Page Wrapper &ndash;&gt;-->

<!--    &lt;!&ndash; Scroll to Top Button&ndash;&gt;-->
<!--    <a class="scroll-to-top rounded" href="#page-top">-->
<!--        <i class="fas fa-angle-up"></i>-->
<!--    </a>-->

<!--    &lt;!&ndash; Logout Modal&ndash;&gt;-->
<!--    <th:block th:replace="~{fragments/logout-modal :: logout-modal}"></th:block>-->

<!--    &lt;!&ndash; Create Alert Modal &ndash;&gt;-->
<!--    <div class="modal fade" id="createAlertModal" tabindex="-1" role="dialog" aria-labelledby="createAlertModalLabel" aria-hidden="true">-->
<!--        <div class="modal-dialog modal-lg" role="document">-->
<!--            <div class="modal-content">-->
<!--                <div class="modal-header">-->
<!--                    <h5 class="modal-title" id="createAlertModalLabel">Create New Website Alert</h5>-->
<!--                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                        <span aria-hidden="true">&times;</span>-->
<!--                    </button>-->
<!--                </div>-->
<!--                <div class="modal-body">-->
<!--                    <form id="createAlertForm">-->
<!--                        <input type="hidden" id="alertId" value="0" />-->

<!--                        <div class="form-group">-->
<!--                            <label for="message">Alert Message</label>-->
<!--                            <textarea class="form-control" id="message" rows="3" required></textarea>-->
<!--                            <small class="form-text text-muted">Enter the message that will be displayed to users.</small>-->
<!--                        </div>-->

<!--                        <div class="form-group" id="companiesContainer">-->
<!--                            <label>Companies</label>-->
<!--                            <div class="mb-2">-->
<!--                                <button type="button" id="allCompaniesBtn" class="btn btn-outline-primary mb-2">All Companies</button>-->
<!--                            </div>-->
<!--                            <div class="d-flex flex-wrap" id="companyButtonsContainer">-->
<!--                                &lt;!&ndash; Company buttons will be added here &ndash;&gt;-->
<!--                                <div class="spinner-border text-primary mr-2" role="status">-->
<!--                                    <span class="sr-only">Loading...</span>-->
<!--                                </div>-->
<!--                                <span>Loading companies...</span>-->
<!--                            </div>-->
<!--                            <input type="hidden" id="selectedCompanies" name="selectedCompanies" />-->
<!--                            <small class="form-text text-muted">Select which companies should see this alert. Selected companies appear in blue. Clicking "All Companies" will show the alert to everyone.</small>-->
<!--                        </div>-->

<!--                        <div class="form-group">-->
<!--                            <div class="custom-control custom-switch">-->
<!--                                <input type="checkbox" class="custom-control-input" id="isActive" checked>-->
<!--                                <label class="custom-control-label" for="isActive">Active</label>-->
<!--                            </div>-->
<!--                            <small class="form-text text-muted">Toggle to activate or deactivate this alert.</small>-->
<!--                        </div>-->

<!--                        <div class="alert alert-danger" id="errorMessage" style="display: none;"></div>-->
<!--                    </form>-->
<!--                </div>-->
<!--                <div class="modal-footer">-->
<!--                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>-->
<!--                    <button type="button" class="btn btn-primary" id="saveAlertBtn">Save Alert</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Add styles for company buttons &ndash;&gt;-->
<!--    <style>-->
<!--        .company-btn {-->
<!--            margin-right: 0.5rem;-->
<!--            margin-bottom: 0.5rem;-->
<!--        }-->
<!--        .company-selected {-->
<!--            background-color: #4e73df;-->
<!--            color: white;-->
<!--        }-->
<!--    </style>-->

<!--    &lt;!&ndash; JavaScript for the alerts functionality &ndash;&gt;-->
<!--    <script>-->
<!--        document.addEventListener('DOMContentLoaded', function() {-->
<!--            // Initialize Bootstrap components-->
<!--            $('[data-toggle="modal"]').modal();-->

<!--            // Load alerts for the table-->
<!--            loadAlerts();-->

<!--            // Load companies for the modal-->
<!--            loadCompanies();-->

<!--            // Set up all companies button-->
<!--            document.getElementById('allCompaniesBtn').addEventListener('click', function() {-->
<!--                toggleAllCompanies();-->
<!--            });-->

<!--            // Set up save button-->
<!--            document.getElementById('saveAlertBtn').addEventListener('click', function() {-->
<!--                saveAlert();-->
<!--            });-->

<!--            // Reset modal when closed-->
<!--            $('#createAlertModal').on('hidden.bs.modal', function () {-->
<!--                resetCreateForm();-->
<!--            });-->
<!--        });-->

<!--        // Store selected company IDs-->
<!--        let selectedCompanyIds = [];-->
<!--        let allCompaniesSelected = false;-->

<!--        // Load alerts from API-->
<!--        function loadAlerts() {-->
<!--            console.log("ðŸ“¢ Loading alerts...");-->
<!--            fetch('/api/admin/website-alerts/list', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                }-->
<!--            })-->
<!--            .then(response => {-->
<!--                if (!response.ok) {-->
<!--                    throw new Error(`HTTP error! Status: ${response.status}`);-->
<!--                }-->
<!--                return response.json();-->
<!--            })-->
<!--            .then(result => {-->
<!--                console.log("ðŸ“¢ Alerts response received:", result);-->
<!--                if (!result) {-->
<!--                    throw new Error("Empty response received");-->
<!--                }-->

<!--                if (result.data && Array.isArray(result.data)) {-->
<!--                    populateAlertsTable(result.data);-->
<!--                    console.log("ðŸ“¢ Alerts loaded successfully:", result.data.length);-->
<!--                } else if (result.error) {-->
<!--                    console.error('Failed to load alerts: ' + result.error);-->
<!--                } else {-->
<!--                    console.error('Failed to load alerts: Invalid response format');-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("ðŸ“¢ Error loading alerts:", error);-->
<!--            });-->
<!--        }-->

<!--        // Populate the alerts table-->
<!--        function populateAlertsTable(alerts) {-->
<!--            const tableBody = document.querySelector('#alertsTable tbody');-->
<!--            tableBody.innerHTML = '';-->

<!--            if (alerts.length === 0) {-->
<!--                const row = document.createElement('tr');-->
<!--                row.innerHTML = '<td colspan="7" class="text-center">No alerts found</td>';-->
<!--                tableBody.appendChild(row);-->
<!--                return;-->
<!--            }-->

<!--            alerts.forEach(alert => {-->
<!--                const row = document.createElement('tr');-->

<!--                // Determine company display-->
<!--                let companyDisplay = 'All Companies';-->
<!--                if (alert.company_ids && !alert.company_ids.includes('all')) {-->
<!--                    companyDisplay = `${alert.company_ids.length} Companies`;-->
<!--                }-->

<!--                row.innerHTML = `-->
<!--                    <td>Alert #${alert.id}</td>-->
<!--                    <td>${alert.message}</td>-->
<!--                    <td>${companyDisplay}</td>-->
<!--                    <td>${formatDate(alert.created_at)}</td>-->
<!--                    <td>${formatDate(alert.updated_at)}</td>-->
<!--                    <td>-->
<!--                        <span class="badge badge-${alert.is_active ? 'success' : 'secondary'}">-->
<!--                            ${alert.is_active ? 'Active' : 'Inactive'}-->
<!--                        </span>-->
<!--                    </td>-->
<!--                    <td>-->
<!--                        <a href="/admin/alerts/edit/${alert.id}" class="btn btn-sm btn-primary">-->
<!--                            <i class="fas fa-edit"></i> Edit-->
<!--                        </a>-->
<!--                    </td>-->
<!--                `;-->

<!--                tableBody.appendChild(row);-->
<!--            });-->
<!--        }-->

<!--        // Load companies from API-->
<!--        function loadCompanies() {-->
<!--            console.log("ðŸ¢ Loading companies...");-->
<!--            fetch('/api/companies/list', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                }-->
<!--            })-->
<!--            .then(response => {-->
<!--                if (!response.ok) {-->
<!--                    throw new Error(`HTTP error! Status: ${response.status}`);-->
<!--                }-->
<!--                return response.json();-->
<!--            })-->
<!--            .then(result => {-->
<!--                console.log("ðŸ¢ Companies response received:", result);-->
<!--                if (!result) {-->
<!--                    throw new Error("Empty response received");-->
<!--                }-->

<!--                if (result.data && Array.isArray(result.data)) {-->
<!--                    const container = document.getElementById('companyButtonsContainer');-->
<!--                    container.innerHTML = ''; // Clear loading indicator-->

<!--                    result.data.forEach(company => {-->
<!--                        createCompanyButton(company, container);-->
<!--                    });-->
<!--                    console.log("ðŸ¢ Companies loaded successfully:", result.data.length);-->
<!--                } else if (result.error) {-->
<!--                    showError('Failed to load companies: ' + result.error);-->
<!--                } else {-->
<!--                    showError('Failed to load companies: Invalid response format');-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("ðŸ¢ Error loading companies:", error);-->
<!--                showError('Failed to load companies: ' + error.message);-->
<!--            });-->
<!--        }-->

<!--        // Create a button for a company-->
<!--        function createCompanyButton(company, container) {-->
<!--            const button = document.createElement('button');-->
<!--            button.type = 'button';-->
<!--            button.className = 'btn btn-outline-secondary company-btn';-->
<!--            button.dataset.companyId = company.companyId;-->
<!--            button.textContent = company.companyName;-->

<!--            button.addEventListener('click', function() {-->
<!--                toggleCompany(company.companyId);-->
<!--            });-->

<!--            container.appendChild(button);-->
<!--        }-->

<!--        // Toggle a company selection-->
<!--        function toggleCompany(companyId) {-->
<!--            if (allCompaniesSelected) {-->
<!--                // If "All Companies" was selected, deselect it first-->
<!--                allCompaniesSelected = false;-->
<!--                document.getElementById('allCompaniesBtn').classList.remove('company-selected');-->
<!--                document.getElementById('allCompaniesBtn').classList.remove('btn-primary');-->
<!--                document.getElementById('allCompaniesBtn').classList.add('btn-outline-primary');-->
<!--                selectedCompanyIds = [];-->
<!--            }-->

<!--            const index = selectedCompanyIds.indexOf(companyId);-->
<!--            const button = document.querySelector(`.company-btn[data-company-id="${companyId}"]`);-->

<!--            if (index === -1) {-->
<!--                // Add company-->
<!--                selectedCompanyIds.push(companyId);-->
<!--                button.classList.add('company-selected');-->
<!--                button.classList.remove('btn-outline-secondary');-->
<!--                button.classList.add('btn-primary');-->
<!--            } else {-->
<!--                // Remove company-->
<!--                selectedCompanyIds.splice(index, 1);-->
<!--                button.classList.remove('company-selected');-->
<!--                button.classList.remove('btn-primary');-->
<!--                button.classList.add('btn-outline-secondary');-->
<!--            }-->

<!--            updateSelectedCompaniesInput();-->
<!--        }-->

<!--        // Toggle "All Companies" selection-->
<!--        function toggleAllCompanies() {-->
<!--            const allCompaniesBtn = document.getElementById('allCompaniesBtn');-->

<!--            if (allCompaniesSelected) {-->
<!--                // Deselect "All Companies"-->
<!--                allCompaniesSelected = false;-->
<!--                allCompaniesBtn.classList.remove('company-selected');-->
<!--                allCompaniesBtn.classList.remove('btn-primary');-->
<!--                allCompaniesBtn.classList.add('btn-outline-primary');-->
<!--            } else {-->
<!--                // Select "All Companies" and deselect all other companies-->
<!--                allCompaniesSelected = true;-->
<!--                allCompaniesBtn.classList.add('company-selected');-->
<!--                allCompaniesBtn.classList.remove('btn-outline-primary');-->
<!--                allCompaniesBtn.classList.add('btn-primary');-->

<!--                // Deselect all individual companies-->
<!--                document.querySelectorAll('.company-btn').forEach(btn => {-->
<!--                    btn.classList.remove('company-selected');-->
<!--                    btn.classList.remove('btn-primary');-->
<!--                    btn.classList.add('btn-outline-secondary');-->
<!--                });-->

<!--                selectedCompanyIds = [];-->
<!--            }-->

<!--            updateSelectedCompaniesInput();-->
<!--        }-->

<!--        // Update the hidden input field with selected companies-->
<!--        function updateSelectedCompaniesInput() {-->
<!--            const input = document.getElementById('selectedCompanies');-->
<!--            if (allCompaniesSelected) {-->
<!--                input.value = JSON.stringify(['all']);-->
<!--            } else {-->
<!--                input.value = JSON.stringify(selectedCompanyIds);-->
<!--            }-->
<!--        }-->

<!--        // Save the alert-->
<!--        function saveAlert() {-->
<!--            // Show loading state-->
<!--            const saveButton = document.getElementById('saveAlertBtn');-->
<!--            const originalText = saveButton.textContent;-->
<!--            saveButton.textContent = 'Saving...';-->
<!--            saveButton.disabled = true;-->

<!--            // Gather form values-->
<!--            const message = document.getElementById('message').value.trim();-->
<!--            const isActive = document.getElementById('isActive').checked;-->

<!--            // Validate-->
<!--            if (!message) {-->
<!--                showError('Message is required');-->
<!--                saveButton.textContent = originalText;-->
<!--                saveButton.disabled = false;-->
<!--                return;-->
<!--            }-->

<!--            // Get selected companies-->
<!--            let finalCompanyIds;-->
<!--            if (allCompaniesSelected) {-->
<!--                finalCompanyIds = ['all'];-->
<!--            } else if (selectedCompanyIds.length === 0) {-->
<!--                showError('At least one company must be selected');-->
<!--                saveButton.textContent = originalText;-->
<!--                saveButton.disabled = false;-->
<!--                return;-->
<!--            } else {-->
<!--                finalCompanyIds = selectedCompanyIds;-->
<!--            }-->

<!--            // Create request body-->
<!--            const requestBody = {-->
<!--                id: 0, // Always 0 for new alerts-->
<!--                message: message,-->
<!--                is_active: isActive,-->
<!--                company_ids: finalCompanyIds-->
<!--            };-->

<!--            console.log("ðŸ“¢ Creating alert with data:", requestBody);-->

<!--            // Send to API-->
<!--            fetch('/api/admin/website-alerts/upsert', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json'-->
<!--                },-->
<!--                body: JSON.stringify(requestBody)-->
<!--            })-->
<!--            .then(response => {-->
<!--                if (!response.ok) {-->
<!--                    throw new Error(`HTTP error! Status: ${response.status}`);-->
<!--                }-->
<!--                return response.json();-->
<!--            })-->
<!--            .then(result => {-->
<!--                if (result.data) {-->
<!--                    // Show success message-->
<!--                    const successMessage = document.createElement('div');-->
<!--                    successMessage.className = 'alert alert-success';-->
<!--                    successMessage.textContent = 'Alert created successfully!';-->
<!--                    document.querySelector('.container-fluid').insertBefore(successMessage, document.querySelector('.row'));-->

<!--                    // Auto-hide success message after 5 seconds-->
<!--                    setTimeout(() => {-->
<!--                        successMessage.remove();-->
<!--                    }, 5000);-->

<!--                    // Close modal and reload alerts-->
<!--                    $('#createAlertModal').modal('hide');-->
<!--                    loadAlerts();-->
<!--                } else if (result.error) {-->
<!--                    showError('Failed to save alert: ' + result.error);-->
<!--                } else {-->
<!--                    showError('Failed to save alert: Invalid response format');-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error("ðŸ“¢ Error saving alert:", error);-->
<!--                showError('Failed to save alert: ' + error.message);-->
<!--            })-->
<!--            .finally(() => {-->
<!--                // Reset button state-->
<!--                saveButton.textContent = originalText;-->
<!--                saveButton.disabled = false;-->
<!--            });-->
<!--        }-->

<!--        // Reset the create form-->
<!--        function resetCreateForm() {-->
<!--            document.getElementById('message').value = '';-->
<!--            document.getElementById('isActive').checked = true;-->
<!--            document.getElementById('errorMessage').style.display = 'none';-->

<!--            // Reset company selections-->
<!--            allCompaniesSelected = false;-->
<!--            selectedCompanyIds = [];-->

<!--            // Reset UI-->
<!--            document.getElementById('allCompaniesBtn').classList.remove('company-selected');-->
<!--            document.getElementById('allCompaniesBtn').classList.remove('btn-primary');-->
<!--            document.getElementById('allCompaniesBtn').classList.add('btn-outline-primary');-->

<!--            document.querySelectorAll('.company-btn').forEach(btn => {-->
<!--                btn.classList.remove('company-selected');-->
<!--                btn.classList.remove('btn-primary');-->
<!--                btn.classList.add('btn-outline-secondary');-->
<!--            });-->

<!--            updateSelectedCompaniesInput();-->
<!--        }-->

<!--        // Format a date string-->
<!--        function formatDate(dateString) {-->
<!--            if (!dateString) return '-';-->
<!--            const date = new Date(dateString);-->
<!--            return date.toLocaleString();-->
<!--        }-->

<!--        // Show error message-->
<!--        function showError(message) {-->
<!--            const errorElement = document.getElementById('errorMessage');-->
<!--            errorElement.textContent = message;-->
<!--            errorElement.style.display = 'block';-->

<!--            // Ensure error is visible by scrolling to it-->
<!--            errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });-->

<!--            // Auto-hide error after 10 seconds-->
<!--            setTimeout(() => {-->
<!--                errorElement.style.display = 'none';-->
<!--            }, 10000);-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html> -->
